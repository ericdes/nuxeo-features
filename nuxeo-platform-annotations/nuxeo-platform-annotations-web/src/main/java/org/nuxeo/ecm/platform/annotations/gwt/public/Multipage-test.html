<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<TITLE>/tmp//PDF2Html/1221756146608/index</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<META name="generator" content="pdftohtml 0.36">
</HEAD>
<BODY bgcolor="#A0A0A0" vlink="blue" link="blue">
<!-- Page 1 -->
<a name="1"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
  .ft0{font-size:30px;font-family:Helvetica;color:#000000;}
  .ft1{font-size:10px;font-family:Helvetica;color:#000000;}
-->
</STYLE>
<IMG width="595" height="842" src="index001.png" alt="background image">
<DIV style="position:absolute;top:290;left:59"><nobr><span class="ft0"><b>Nuxeo EP 5 - Nuxeo Annotation</b></span></nobr></DIV>

<DIV style="position:absolute;top:329;left:242"><nobr><span class="ft0"><b>Service</b></span></nobr></DIV>
<DIV style="position:absolute;top:691;left:199"><nobr><span class="ft1">Copyright Â© 2000-2007, Nuxeo SAS.</span></nobr></DIV>
</DIV>
<!-- Page 2 -->
<a name="2"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
  .ft2{font-size:15px;font-family:Helvetica;color:#000000;}
  .ft3{font-size:10px;font-family:Times;color:#000000;}
  .ft4{font-size:10px;line-height:14px;font-family:Times;color:#000000;}
-->
</STYLE>
<IMG width="595" height="842" src="index002.png" alt="background image">
<DIV style="position:absolute;top:83;left:51"><nobr><span class="ft2"><b>Table of Contents</b></span></nobr></DIV>
<DIV style="position:absolute;top:112;left:51"><nobr><span class="ft3"><A href="index.html#4">1. Requirements overview </a>.............................................................................................................1</span></nobr></DIV>
<DIV style="position:absolute;top:127;left:75"><nobr><span class="ft4"><A href="index.html#4">1.1. W3C Annotea </a>..................................................................................................................1<br><A href="index.html#4">1.2. Extensions to Annotea </a>....................................................................................................1</span></nobr></DIV>

<DIV style="position:absolute;top:155;left:99"><nobr><span class="ft4"><A href="index.html#4">1.2.1. URLs vs Document Ids </a>........................................................................................1<br><A href="index.html#4">1.2.2. Image annotation </a>..................................................................................................1<br><A href="index.html#4">1.2.3. Metadata management </a>.........................................................................................1<br><A href="index.html#5">1.2.4. Permission management </a>......................................................................................2</span></nobr></DIV>
<DIV style="position:absolute;top:213;left:75"><nobr><span class="ft3"><A href="index.html#5">1.3. Additionnal requirements </a>................................................................................................2</span></nobr></DIV>
<DIV style="position:absolute;top:227;left:99"><nobr><span class="ft4"><A href="index.html#5">1.3.1. Integration in Nuxeo preview system </a>..................................................................2<br><A href="index.html#5">1.3.2. Stand alone html client </a>.........................................................................................2</span></nobr></DIV>

<DIV style="position:absolute;top:256;left:51"><nobr><span class="ft4"><A href="index.html#6">2. Logical architecture overview </a>....................................................................................................3<br><A href="index.html#8">3. NXAS HTML Client </a>..................................................................................................................5</span></nobr></DIV>
<DIV style="position:absolute;top:285;left:75"><nobr><span class="ft4"><A href="index.html#8">3.1. Overview </a>.........................................................................................................................5<br><A href="index.html#8">3.2. Implementation </a>...............................................................................................................5</span></nobr></DIV>
<DIV style="position:absolute;top:314;left:51"><nobr><span class="ft3"><A href="index.html#9">4. Annotation Service Core </a>............................................................................................................6</span></nobr></DIV>
<DIV style="position:absolute;top:328;left:75"><nobr><span class="ft4"><A href="index.html#9">4.1. Overview </a>.........................................................................................................................6<br><A href="index.html#9">4.2. Implementation </a>...............................................................................................................6<br><A href="index.html#9">4.3. Storage </a>............................................................................................................................6<br><A href="index.html#9">4.4. Query Support </a>.................................................................................................................6<br><A href="index.html#10">4.5. Extension points </a>..............................................................................................................7</span></nobr></DIV>

<DIV style="position:absolute;top:400;left:99"><nobr><span class="ft4"><A href="index.html#10">4.5.1. urlResolver </a>...........................................................................................................7<br><A href="index.html#10">4.5.2. urlPatternFilter </a>.....................................................................................................7<br><A href="index.html#10">4.5.3. metadata </a>...............................................................................................................7<br><A href="index.html#10">4.5.4. permissionManager </a>..............................................................................................7<br><A href="index.html#10">4.5.5. annotabilityManager </a>............................................................................................7<br><A href="index.html#11">4.5.6. eventManager </a>.......................................................................................................8</span></nobr></DIV>
<DIV style="position:absolute;top:487;left:75"><nobr><span class="ft4"><A href="index.html#11">4.6. Event management </a>..........................................................................................................8<br><A href="index.html#11">4.7. URLs and Document </a>.......................................................................................................8<br><A href="index.html#11">4.8. XPointer extension </a>..........................................................................................................8</span></nobr></DIV>

<DIV style="position:absolute;top:530;left:51"><nobr><span class="ft3"><A href="index.html#13">5. Annotation Service Facade </a>......................................................................................................10</span></nobr></DIV>
<DIV style="position:absolute;top:544;left:75"><nobr><span class="ft4"><A href="index.html#13">5.1. Implementation </a>.............................................................................................................10<br><A href="index.html#13">5.2. JMS </a>...............................................................................................................................10<br><A href="index.html#13">5.3. Extension points </a>............................................................................................................10</span></nobr></DIV>
<DIV style="position:absolute;top:587;left:99"><nobr><span class="ft3"><A href="index.html#13">5.3.1. annotationsRules </a>................................................................................................10</span></nobr></DIV>
<DIV style="position:absolute;top:602;left:51"><nobr><span class="ft3"><A href="index.html#15">6. Annotation Service Javascript Library </a>.....................................................................................12</span></nobr></DIV>
<DIV style="position:absolute;top:616;left:75"><nobr><span class="ft4"><A href="index.html#15">6.1. overview </a>........................................................................................................................12<br><A href="index.html#15">6.2. Implementation </a>.............................................................................................................12<br><A href="index.html#15">6.3. RDF / JSON </a>..................................................................................................................12<br><A href="index.html#15">6.4. Annotating images </a>........................................................................................................12</span></nobr></DIV>

<DIV style="position:absolute;top:674;left:51"><nobr><span class="ft3"><A href="index.html#16">7. Annotation Service HTTP Gateway </a>........................................................................................13</span></nobr></DIV>
<DIV style="position:absolute;top:688;left:75"><nobr><span class="ft4"><A href="index.html#16">7.1. Overview </a>.......................................................................................................................13<br><A href="index.html#16">7.2. Implementation </a>.............................................................................................................13<br><A href="index.html#16">7.3. Authentication </a>...............................................................................................................13<br><A href="index.html#16">7.4. State management </a>.........................................................................................................13</span></nobr></DIV>
<DIV style="position:absolute;top:746;left:51"><nobr><span class="ft3"><A href="index.html#17">8. Integrating the Annotation service </a>...........................................................................................14</span></nobr></DIV>
<DIV style="position:absolute;top:760;left:75"><nobr><span class="ft4"><A href="index.html#17">8.1. Configure preview </a>........................................................................................................14<br><A href="index.html#17">8.2. Configure Annotation policy </a>........................................................................................14</span></nobr></DIV>

<DIV style="position:absolute;top:816;left:538"><nobr><span class="ft3">ii</span></nobr></DIV>
</DIV>
<!-- Page 3 -->
<a name="3"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="595" height="842" src="index003.png" alt="background image">
<DIV style="position:absolute;top:44;left:75"><nobr><span class="ft4"><A href="index.html#17">8.3. Configure Annotation Meta-data </a>..................................................................................14<br><A href="index.html#17">8.4. Handle indexing </a>............................................................................................................14<br><A href="index.html#17">8.5. Integrate HTML/JS Client </a>............................................................................................14</span></nobr></DIV>
<DIV style="position:absolute;top:88;left:51"><nobr><span class="ft3"><A href="index.html#18">9. Packaging and deployment </a>......................................................................................................15</span></nobr></DIV>

<DIV style="position:absolute;top:102;left:75"><nobr><span class="ft4"><A href="index.html#18">9.1. Target platform </a>.............................................................................................................15<br><A href="index.html#18">9.2. Packaging </a>......................................................................................................................15</span></nobr></DIV>
<DIV style="position:absolute;top:131;left:51"><nobr><span class="ft3"><A href="index.html#19">10. W3C Annotea compliance </a>.....................................................................................................16</span></nobr></DIV>
<DIV style="position:absolute;top:145;left:75"><nobr><span class="ft4"><A href="index.html#19">10.1. Annotea clients. </a>...........................................................................................................16<br><A href="index.html#19">10.2. Annotea Algae. </a>...........................................................................................................16</span></nobr></DIV>
<DIV style="position:absolute;top:174;left:51"><nobr><span class="ft3"><A href="index.html#20">11. References </a>..............................................................................................................................17</span></nobr></DIV>
<DIV style="position:absolute;top:16;left:200"><nobr><span class="ft3">Nuxeo EP 5 - Nuxeo Annotation Service</span></nobr></DIV>

<DIV style="position:absolute;top:816;left:534"><nobr><span class="ft3">iii</span></nobr></DIV>
</DIV>
<!-- Page 4 -->
<a name="4"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
  .ft5{font-size:19px;font-family:Helvetica;color:#000000;}
  .ft6{font-size:16px;font-family:Helvetica;color:#000000;}
  .ft7{font-size:13px;font-family:Helvetica;color:#000000;}
-->
</STYLE>
<IMG width="595" height="842" src="index004.png" alt="background image">
<DIV style="position:absolute;top:58;left:51"><nobr><span class="ft5"><b>Chapter 1. Requirements overview</b></span></nobr></DIV>
<DIV style="position:absolute;top:95;left:51"><nobr><span class="ft3">This chapter provides an overview of the requirements for the Nuxeo Annotation Service.</span></nobr></DIV>
<DIV style="position:absolute;top:137;left:51"><nobr><span class="ft6"><b>1.1. W3C Annotea</b></span></nobr></DIV>
<DIV style="position:absolute;top:172;left:51"><nobr><span class="ft4">Nuxeo Annotation service will be based on Annotea W3C specification. This basically means that<br>Nuxeo Annotation Service (NXAS) will be compliant with the specification published at<br>http://www.w3.org/2001/Annotea/User/Protocol.html .</span></nobr></DIV>

<DIV style="position:absolute;top:242;left:51"><nobr><span class="ft6"><b>1.2. Extensions to Annotea</b></span></nobr></DIV>
<DIV style="position:absolute;top:277;left:51"><nobr><span class="ft4">The annotea specification is quite old and does not handle all uses cases for annotating documents in<br>the context of Nuxeo ECM. Therefore, we propose to provide some extensions to annotea</span></nobr></DIV>
<DIV style="position:absolute;top:327;left:51"><nobr><span class="ft7"><b>1.2.1. URLs vs Document Ids</b></span></nobr></DIV>
<DIV style="position:absolute;top:359;left:51"><nobr><span class="ft4">The Annotea specification only deals with URLs. In the context of Nuxeo ECM it may be usefull to<br>track the relationship between a URL and a Document Id. Keeping this relation will be usefull for :</span></nobr></DIV>
<DIV style="position:absolute;top:396;left:70"><nobr><span class="ft3">â¢ Managing versioning</span></nobr></DIV>
<DIV style="position:absolute;top:422;left:82"><nobr><span class="ft3">It may be usefull to copy the annotations on a given version to the new version</span></nobr></DIV>
<DIV style="position:absolute;top:449;left:70"><nobr><span class="ft3">â¢ Managing Publication</span></nobr></DIV>
<DIV style="position:absolute;top:475;left:82"><nobr><span class="ft4">Since Nuxeo ECM allow the usage of proxies the same document may be consulted via several<br>URls. With plain Annotea, a document and all it's proxies will have different URLs and then<br>different annotations. In most cases, this is not what we want.</span></nobr></DIV>

<DIV style="position:absolute;top:530;left:70"><nobr><span class="ft3">â¢ Document Indexing</span></nobr></DIV>
<DIV style="position:absolute;top:557;left:82"><nobr><span class="ft4">Some implementations of Nuxeo platform may want to index annotations as meta-data of the<br>document. This will require to be able to extract the annotations from the document UUID.</span></nobr></DIV>
<DIV style="position:absolute;top:607;left:51"><nobr><span class="ft4">For all these reasons, Nuxeo Annotation Service provides a plugable system to be able to keep track<br>of the relationship between a annotated URL and the underlying nuxeo document.</span></nobr></DIV>
<DIV style="position:absolute;top:657;left:51"><nobr><span class="ft7"><b>1.2.2. Image annotation</b></span></nobr></DIV>
<DIV style="position:absolute;top:689;left:51"><nobr><span class="ft4">Inside Nuxeo EP we want to be able to annotate the HTML preview of a document. This preview may<br>include images. This images should be annotatble as the rest of the document, but it will require an<br>extension to the Xpointer specification since user may want to annotate just a portion (zone) of the<br>image.</span></nobr></DIV>
<DIV style="position:absolute;top:768;left:51"><nobr><span class="ft7"><b>1.2.3. Metadata management</b></span></nobr></DIV>

<DIV style="position:absolute;top:816;left:538"><nobr><span class="ft3">1</span></nobr></DIV>
</DIV>
<!-- Page 5 -->
<a name="5"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="595" height="842" src="index005.png" alt="background image">
<DIV style="position:absolute;top:56;left:51"><nobr><span class="ft4">Annotea specification includes very few meta-data. Inside Nuxeo we want the annotation to have a<br>pluggable meta-data schema so that each project implementation may add it's own set of meta-data.</span></nobr></DIV>
<DIV style="position:absolute;top:107;left:51"><nobr><span class="ft7"><b>1.2.4. Permission management</b></span></nobr></DIV>
<DIV style="position:absolute;top:138;left:51"><nobr><span class="ft4">Annotea specification includes no permission management. Inside Nuxeo we require the permission to<br>be checked according to the global security policy.</span></nobr></DIV>

<DIV style="position:absolute;top:194;left:51"><nobr><span class="ft6"><b>1.3. Additionnal requirements</b></span></nobr></DIV>
<DIV style="position:absolute;top:239;left:51"><nobr><span class="ft7"><b>1.3.1. Integration in Nuxeo preview system</b></span></nobr></DIV>
<DIV style="position:absolute;top:270;left:51"><nobr><span class="ft4">The annotation service will provide an integration with the existing Nuxeo Html Preview system. The<br>goal of to use the Nuxeo preview tab to access the annotation feature.</span></nobr></DIV>
<DIV style="position:absolute;top:320;left:51"><nobr><span class="ft7"><b>1.3.2. Stand alone html client</b></span></nobr></DIV>
<DIV style="position:absolute;top:352;left:51"><nobr><span class="ft3">A Standalone html client will be provided.</span></nobr></DIV>
<DIV style="position:absolute;top:16;left:240"><nobr><span class="ft3">Requirements overview</span></nobr></DIV>
<DIV style="position:absolute;top:816;left:538"><nobr><span class="ft3">2</span></nobr></DIV>
</DIV>
<!-- Page 6 -->

<a name="6"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
  .ft8{font-size:6px;font-family:Courier;color:#000000;}
-->
</STYLE>
<IMG width="595" height="842" src="index006.png" alt="background image">
<DIV style="position:absolute;top:58;left:51"><nobr><span class="ft5"><b>Chapter 2. Logical architecture overview</b></span></nobr></DIV>
<DIV style="position:absolute;top:95;left:51"><nobr><span class="ft3">This chapter provides an overview of the logical architecture of the Nuxeo Annotation service.</span></nobr></DIV>
<DIV style="position:absolute;top:118;left:70"><nobr><span class="ft3">â¢ Annotation Service API</span></nobr></DIV>
<DIV style="position:absolute;top:121;left:201"><nobr><span class="ft8">nuxeo-platform-annotations-api</span></nobr></DIV>
<DIV style="position:absolute;top:144;left:82"><nobr><span class="ft4">Provides Java API and all the needed Java artifacts needed to call the Annotation service<br>remotly.</span></nobr></DIV>
<DIV style="position:absolute;top:185;left:70"><nobr><span class="ft3">â¢ Annotation Service Core</span></nobr></DIV>

<DIV style="position:absolute;top:188;left:205"><nobr><span class="ft8">nuxeo-platform-annotations-core</span></nobr></DIV>
<DIV style="position:absolute;top:211;left:82"><nobr><span class="ft4">Provides the Nuxeo Service that exposes the required annotation Java Interface. This service<br>will be implemented as a Nuxeo Runtime component and will provide the needed extension<br>points .</span></nobr></DIV>
<DIV style="position:absolute;top:266;left:70"><nobr><span class="ft3">â¢ Annotation Service Facade</span></nobr></DIV>
<DIV style="position:absolute;top:269;left:215"><nobr><span class="ft8">nuxeo-platform-annotations-facade</span></nobr></DIV>
<DIV style="position:absolute;top:293;left:82"><nobr><span class="ft4">Provides the service EJB3 facade for remote (RMI) access. Also includes integration with JMS<br>: sending JMS events and listen to events via MessageDrivenBeans.</span></nobr></DIV>
<DIV style="position:absolute;top:334;left:70"><nobr><span class="ft3">â¢ Annotation Service Http gateway</span></nobr></DIV>
<DIV style="position:absolute;top:337;left:246"><nobr><span class="ft8">nuxeo-platform-annotations-restlets</span></nobr></DIV>

<DIV style="position:absolute;top:360;left:82"><nobr><span class="ft4">The HTTP Gateway will implement the Annotea HTTP protocol. It will implemented as a set of<br>Restlets that will enable access to the annotation service via http GET/POST requests as defined<br>in the W3C Annotea specification.</span></nobr></DIV>
<DIV style="position:absolute;top:415;left:70"><nobr><span class="ft3">â¢ Annotation Service JavaScript Client</span></nobr></DIV>
<DIV style="position:absolute;top:418;left:264"><nobr><span class="ft8">nuxeo-platform-annotations-js-client</span></nobr></DIV>
<DIV style="position:absolute;top:442;left:82"><nobr><span class="ft3">The JS Library is the client part of the Annotea specification. It will manage :</span></nobr></DIV>
<DIV style="position:absolute;top:468;left:82"><nobr><span class="ft3">â¢ communication with the http gateway</span></nobr></DIV>
<DIV style="position:absolute;top:494;left:82"><nobr><span class="ft3">â¢ extended XPointer resolution</span></nobr></DIV>
<DIV style="position:absolute;top:521;left:82"><nobr><span class="ft3">â¢ annotation display and edit</span></nobr></DIV>
<DIV style="position:absolute;top:547;left:82"><nobr><span class="ft3">â¢ ...</span></nobr></DIV>

<DIV style="position:absolute;top:574;left:70"><nobr><span class="ft3">â¢ Annotation Service preview plugin</span></nobr></DIV>
<DIV style="position:absolute;top:577;left:254"><nobr><span class="ft8">nuxeo-platform-annotations-preview-plugin</span></nobr></DIV>
<DIV style="position:absolute;top:600;left:82"><nobr><span class="ft4">Access to annotations service will be available via the nuxeo preview service. This package will<br>integrate the annotation JS client into the html preview tab.</span></nobr></DIV>
<DIV style="position:absolute;top:641;left:70"><nobr><span class="ft3">â¢ Annotation Service standalone client</span></nobr></DIV>
<DIV style="position:absolute;top:644;left:262"><nobr><span class="ft8">nuxeo-platform-annotations-html-client</span></nobr></DIV>
<DIV style="position:absolute;top:667;left:82"><nobr><span class="ft3">This package will provide a simple stand-alone html client that embeds the JS client.</span></nobr></DIV>
<DIV style="position:absolute;top:816;left:538"><nobr><span class="ft3">3</span></nobr></DIV>
</DIV>
<!-- Page 7 -->

<a name="7"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
  .ft9{font-size:10px;font-family:Times;color:#000000;}
-->
</STYLE>
<IMG width="595" height="842" src="index007.png" alt="background image">
<DIV style="position:absolute;top:442;left:51"><nobr><span class="ft9"><b>Figure 2.1. NXAS Components JPG</b></span></nobr></DIV>
<DIV style="position:absolute;top:16;left:226"><nobr><span class="ft3">Logical architecture overview</span></nobr></DIV>
<DIV style="position:absolute;top:816;left:538"><nobr><span class="ft3">4</span></nobr></DIV>
</DIV>
<!-- Page 8 -->
<a name="8"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
-->
</STYLE>

<IMG width="595" height="842" src="index008.png" alt="background image">
<DIV style="position:absolute;top:58;left:51"><nobr><span class="ft5"><b>Chapter 3. NXAS HTML Client</b></span></nobr></DIV>
<DIV style="position:absolute;top:110;left:51"><nobr><span class="ft6"><b>3.1. Overview</b></span></nobr></DIV>
<DIV style="position:absolute;top:145;left:51"><nobr><span class="ft4">The NXAS HTML Client is the a web interface that can be used by the end user. It is a very simple<br>web application consisting of single html page. The page looks like a browser. It allows to enter URL<br>and show its content. The User can annotate places in the text or part of images, he can<br>see/add/remove/change annotations.</span></nobr></DIV>
<DIV style="position:absolute;top:215;left:51"><nobr><span class="ft4">This HTML client is very much like the annotation system integrated in the Nuxeo preview tab, but<br>without the need of Nuxeo EP.</span></nobr></DIV>
<DIV style="position:absolute;top:256;left:51"><nobr><span class="ft4">This HTML client will be usable in standalone mode outside of Nuxeo. In this standalone mode, the<br>user will have to enter : the url of the annotation service, and his login/password.</span></nobr></DIV>
<DIV style="position:absolute;top:312;left:51"><nobr><span class="ft6"><b>3.2. Implementation</b></span></nobr></DIV>

<DIV style="position:absolute;top:347;left:51"><nobr><span class="ft3">Simple Html page with some JavaScript.</span></nobr></DIV>
<DIV style="position:absolute;top:373;left:51"><nobr><span class="ft3">The Html page displays 3 zones :</span></nobr></DIV>
<DIV style="position:absolute;top:396;left:70"><nobr><span class="ft3">â¢ Server settings</span></nobr></DIV>
<DIV style="position:absolute;top:422;left:82"><nobr><span class="ft3">This zone let the user define his login/password and the Annotation server base URL.</span></nobr></DIV>
<DIV style="position:absolute;top:449;left:70"><nobr><span class="ft3">â¢ Page settings</span></nobr></DIV>
<DIV style="position:absolute;top:475;left:82"><nobr><span class="ft4">This zone let the user enter the URL of the document he wants to annotate. A simple validation<br>button makes the third zone display the targeted page.</span></nobr></DIV>
<DIV style="position:absolute;top:516;left:70"><nobr><span class="ft3">â¢ HTML Page display</span></nobr></DIV>
<DIV style="position:absolute;top:542;left:82"><nobr><span class="ft3">Contains a IFRAME that displays the url selected by the user.</span></nobr></DIV>

<DIV style="position:absolute;top:569;left:82"><nobr><span class="ft3">Annotations tools will be available here.</span></nobr></DIV>
<DIV style="position:absolute;top:605;left:51"><nobr><span class="ft4">The Html Client uses the NXAS JS library to handle communication with the server and to manage<br>annotations on the targeted web page.</span></nobr></DIV>
<DIV style="position:absolute;top:816;left:538"><nobr><span class="ft3">5</span></nobr></DIV>
</DIV>
<!-- Page 9 -->
<a name="9"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="595" height="842" src="index009.png" alt="background image">
<DIV style="position:absolute;top:58;left:51"><nobr><span class="ft5"><b>Chapter 4. Annotation Service Core</b></span></nobr></DIV>
<DIV style="position:absolute;top:110;left:51"><nobr><span class="ft6"><b>4.1. Overview</b></span></nobr></DIV>

<DIV style="position:absolute;top:145;left:51"><nobr><span class="ft4">This is the main component of NXAS, the one that contains all the logic for managing RDF based<br>annotations.</span></nobr></DIV>
<DIV style="position:absolute;top:186;left:51"><nobr><span class="ft4">This component is also responsible for exposing all the needed extension points that will be used for<br>configuration and integration.</span></nobr></DIV>
<DIV style="position:absolute;top:242;left:51"><nobr><span class="ft6"><b>4.2. Implementation</b></span></nobr></DIV>
<DIV style="position:absolute;top:277;left:51"><nobr><span class="ft4">The service is implemented as a Runtime service on top of a Nuxeo Runtime component. The runtime<br>component will provide the extension point mechanisms. The API provided by the service will target<br>managing annotations on both URLs and documents.</span></nobr></DIV>
<DIV style="position:absolute;top:332;left:51"><nobr><span class="ft3">As any Nuxeo Service, the Annotation Service is accessible via the Runtime lookup method :</span></nobr></DIV>
<DIV style="position:absolute;top:358;left:59"><nobr><span class="ft8">Framework.getLocalService(AnnotationService.class)</span></nobr></DIV>
<DIV style="position:absolute;top:407;left:51"><nobr><span class="ft6"><b>4.3. Storage</b></span></nobr></DIV>

<DIV style="position:absolute;top:442;left:51"><nobr><span class="ft3">The Annotation service will store the annotations as a RDF graph.</span></nobr></DIV>
<DIV style="position:absolute;top:468;left:51"><nobr><span class="ft4">The Annotation service will contribute a new RDF Graph, a new set of RDF predicate and a new set<br>of resources adapters for the Nuxeo Relation Service. Nuxeo Relation Service is responsible for<br>storing and managing the RDF data.</span></nobr></DIV>
<DIV style="position:absolute;top:523;left:51"><nobr><span class="ft3">According to Annotea specifications, the felowing graphs and namespaces will be supported:</span></nobr></DIV>
<DIV style="position:absolute;top:546;left:70"><nobr><span class="ft3">â¢ http://www.w3.org/2000/10/annotation-ns</span></nobr></DIV>
<DIV style="position:absolute;top:573;left:70"><nobr><span class="ft3">â¢ http://www.w3.org/2001/03/thread</span></nobr></DIV>
<DIV style="position:absolute;top:599;left:70"><nobr><span class="ft3">â¢ http://www.w3.org/2001/12/replyType</span></nobr></DIV>
<DIV style="position:absolute;top:623;left:51"><nobr><span class="ft3">These graphs will be extended and completed to support the extension to the specification :</span></nobr></DIV>
<DIV style="position:absolute;top:646;left:70"><nobr><span class="ft3">â¢ XPointer extension to support Images</span></nobr></DIV>

<DIV style="position:absolute;top:672;left:70"><nobr><span class="ft3">â¢ Pluggable meta-data management</span></nobr></DIV>
<DIV style="position:absolute;top:699;left:70"><nobr><span class="ft3">â¢ Document vs URLs management</span></nobr></DIV>
<DIV style="position:absolute;top:750;left:51"><nobr><span class="ft6"><b>4.4. Query Support</b></span></nobr></DIV>
<DIV style="position:absolute;top:785;left:51"><nobr><span class="ft3">Even if Algae won't be implemented, NXAS will provide a Query API to retrive Annotations based on</span></nobr></DIV>
<DIV style="position:absolute;top:816;left:538"><nobr><span class="ft3">6</span></nobr></DIV>
</DIV>
<!-- Page 10 -->
<a name="10"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="595" height="842" src="index010.png" alt="background image">

<DIV style="position:absolute;top:56;left:51"><nobr><span class="ft3">criteria.</span></nobr></DIV>
<DIV style="position:absolute;top:83;left:51"><nobr><span class="ft3">Search criteria include :</span></nobr></DIV>
<DIV style="position:absolute;top:106;left:70"><nobr><span class="ft3">â¢ target Document URL or DocumentLocation</span></nobr></DIV>
<DIV style="position:absolute;top:132;left:70"><nobr><span class="ft3">â¢ attributes of the annotation</span></nobr></DIV>
<DIV style="position:absolute;top:158;left:70"><nobr><span class="ft3">â¢ attributes of the author of the annotation</span></nobr></DIV>
<DIV style="position:absolute;top:210;left:51"><nobr><span class="ft6"><b>4.5. Extension points</b></span></nobr></DIV>
<DIV style="position:absolute;top:245;left:51"><nobr><span class="ft3">The runtime service will manage several exctension points in order to provide the needed flexibility.</span></nobr></DIV>
<DIV style="position:absolute;top:281;left:51"><nobr><span class="ft7"><b>4.5.1. urlResolver</b></span></nobr></DIV>
<DIV style="position:absolute;top:312;left:51"><nobr><span class="ft4">The urlResolver extension point allows to contribute a class that is responsible for resolving url to<br>Document Location (repository name / document UUID).</span></nobr></DIV>

<DIV style="position:absolute;top:353;left:51"><nobr><span class="ft4">This extension point is very important since it will provide the link between documents and URLs that<br>will be used for the versionning and proxy resolution.</span></nobr></DIV>
<DIV style="position:absolute;top:394;left:51"><nobr><span class="ft4">The default implementation will use the url codec service to try to do the translation. The preview<br>URL system will also be supported.</span></nobr></DIV>
<DIV style="position:absolute;top:444;left:51"><nobr><span class="ft7"><b>4.5.2. urlPatternFilter</b></span></nobr></DIV>
<DIV style="position:absolute;top:475;left:51"><nobr><span class="ft4">The urlPatternFilter extension point allows to contribute regular expression pattern to the list of<br>allowed URL pattern or disallowed URL pattern. When a request is made to get/set annotations on an<br>URL, the server check the list. If the URL match a pattern on the disallowed list, then no action will<br>be possible. Then if the URL match a pattern on the allowed list, then annotation will be processed.</span></nobr></DIV>
<DIV style="position:absolute;top:554;left:51"><nobr><span class="ft7"><b>4.5.3. metadata</b></span></nobr></DIV>
<DIV style="position:absolute;top:586;left:51"><nobr><span class="ft4">The metadata extension point allows to contribute class that provides metadata. The class implements<br>a simple interface. Its duty is to return a Map of metadata when being passed the annotation and<br>author name. The default implementation is to provide author, timestamp, annotation type and author<br>organizational unit.</span></nobr></DIV>

<DIV style="position:absolute;top:665;left:51"><nobr><span class="ft7"><b>4.5.4. permissionManager</b></span></nobr></DIV>
<DIV style="position:absolute;top:696;left:51"><nobr><span class="ft4">The permissionManager extension point allows to contribute a class that will check viewAnnotation,<br>updateAnnotation and deleteAnnotation on URL. The default behavior is to map to the<br>view/update/delete permission on the corresponding document.</span></nobr></DIV>
<DIV style="position:absolute;top:761;left:51"><nobr><span class="ft7"><b>4.5.5. annotabilityManager</b></span></nobr></DIV>
<DIV style="position:absolute;top:16;left:238"><nobr><span class="ft3">Annotation Service Core</span></nobr></DIV>
<DIV style="position:absolute;top:816;left:538"><nobr><span class="ft3">7</span></nobr></DIV>
</DIV>
<!-- Page 11 -->
<a name="11"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
-->

</STYLE>
<IMG width="595" height="842" src="index011.png" alt="background image">
<DIV style="position:absolute;top:56;left:51"><nobr><span class="ft4">The annotabilityManager extension point allows to contribute a class to fine grain which documents<br>can be annotated. Default implementation will allow simple filtring on Document facet 'Annotable'.</span></nobr></DIV>
<DIV style="position:absolute;top:107;left:51"><nobr><span class="ft7"><b>4.5.6. eventManager</b></span></nobr></DIV>
<DIV style="position:absolute;top:138;left:51"><nobr><span class="ft4">The eventManager extension point allows to contribute a listener class handle annotation related<br>events.</span></nobr></DIV>
<DIV style="position:absolute;top:194;left:51"><nobr><span class="ft6"><b>4.6. Event management</b></span></nobr></DIV>
<DIV style="position:absolute;top:229;left:51"><nobr><span class="ft3">The Annotation service will trigger several events associated to annotations :</span></nobr></DIV>
<DIV style="position:absolute;top:252;left:70"><nobr><span class="ft3">â¢ annotationCreated</span></nobr></DIV>
<DIV style="position:absolute;top:278;left:70"><nobr><span class="ft3">â¢ annotationModified</span></nobr></DIV>

<DIV style="position:absolute;top:305;left:70"><nobr><span class="ft3">â¢ annotationDeleted</span></nobr></DIV>
<DIV style="position:absolute;top:329;left:51"><nobr><span class="ft4">Each event will be trigger twice : once before the action and once after the action. Event listeners are<br>synchonous and have an interface that is very much like the core event listeners.</span></nobr></DIV>
<DIV style="position:absolute;top:385;left:51"><nobr><span class="ft6"><b>4.7. URLs and Document</b></span></nobr></DIV>
<DIV style="position:absolute;top:420;left:51"><nobr><span class="ft4">The resolution between URLs and Document will rely in the contributed urlResolver plugins. A<br>built-in event listener will use this plugin to propagate annotations to the target document if url can be<br>resolved. As a single Nuxeo Document can have several preview URLs, the relation can not be a<br>bijection between a URL and a Document. The Bijection is between a URL and a tuple<br>(DocumentLocation, xpath of target field). Basically there will be a relation between a<br>(DocumentLocation, path) and the URL, the annotations will be linked to the URL and to the tuple<br>(DocumentLocation, path) (if available). This means than when retrieving annotation from an URL<br>the service will :</span></nobr></DIV>
<DIV style="position:absolute;top:543;left:70"><nobr><span class="ft3">â¢ resolve URL to (DocumentLocation, path) if possible</span></nobr></DIV>

<DIV style="position:absolute;top:570;left:70"><nobr><span class="ft3">â¢ resolve proxy if DocumentLocation is a proxy</span></nobr></DIV>
<DIV style="position:absolute;top:596;left:70"><nobr><span class="ft3">â¢ get the annotations linked to this (DocumentLocation, path)</span></nobr></DIV>
<DIV style="position:absolute;top:632;left:51"><nobr><span class="ft4">In most cases, a Nuxeo Document has only one preview URL associated to the default preview xpath<br>(see preview component doc).</span></nobr></DIV>
<DIV style="position:absolute;top:688;left:51"><nobr><span class="ft6"><b>4.8. XPointer extension</b></span></nobr></DIV>
<DIV style="position:absolute;top:723;left:51"><nobr><span class="ft4">The XPointer W3C specification is based on XPath and is made to identify a fragment of an html<br>document.</span></nobr></DIV>
<DIV style="position:absolute;top:764;left:51"><nobr><span class="ft4">The XPointer synthax will be extended to include the possibility to identify a shape inside a image<br>that is inside the HTML page. The NXPointer will typically contain the XPath to locate the image</span></nobr></DIV>
<DIV style="position:absolute;top:16;left:238"><nobr><span class="ft3">Annotation Service Core</span></nobr></DIV>

<DIV style="position:absolute;top:816;left:538"><nobr><span class="ft3">8</span></nobr></DIV>
</DIV>
<!-- Page 12 -->
<a name="12"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="595" height="842" src="index012.png" alt="background image">
<DIV style="position:absolute;top:56;left:51"><nobr><span class="ft3">within the HTML document and a shape descriptor with pixel based values.</span></nobr></DIV>
<DIV style="position:absolute;top:16;left:238"><nobr><span class="ft3">Annotation Service Core</span></nobr></DIV>
<DIV style="position:absolute;top:816;left:538"><nobr><span class="ft3">9</span></nobr></DIV>
</DIV>
<!-- Page 13 -->

<a name="13"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="595" height="842" src="index013.png" alt="background image">
<DIV style="position:absolute;top:58;left:51"><nobr><span class="ft5"><b>Chapter 5. Annotation Service Facade</b></span></nobr></DIV>
<DIV style="position:absolute;top:95;left:51"><nobr><span class="ft4">As for any Nuxeo Service, the facade will provide the integration of the service into JEE<br>infrastructure.</span></nobr></DIV>
<DIV style="position:absolute;top:136;left:51"><nobr><span class="ft3">This includes :</span></nobr></DIV>
<DIV style="position:absolute;top:158;left:70"><nobr><span class="ft3">â¢ Remoting</span></nobr></DIV>
<DIV style="position:absolute;top:185;left:70"><nobr><span class="ft3">â¢ Transactions</span></nobr></DIV>
<DIV style="position:absolute;top:211;left:70"><nobr><span class="ft3">â¢ JMS</span></nobr></DIV>

<DIV style="position:absolute;top:263;left:51"><nobr><span class="ft6"><b>5.1. Implementation</b></span></nobr></DIV>
<DIV style="position:absolute;top:298;left:51"><nobr><span class="ft3">EJB3 Stateless Session Bean facade on top of the runtime service.</span></nobr></DIV>
<DIV style="position:absolute;top:324;left:51"><nobr><span class="ft3">This makes the Annotation Service remotable and accessible via the standard Nuxeo Lookup facility :</span></nobr></DIV>
<DIV style="position:absolute;top:350;left:59"><nobr><span class="ft8">Framework.getService(AnnotationService.class)</span></nobr></DIV>
<DIV style="position:absolute;top:399;left:51"><nobr><span class="ft6"><b>5.2. JMS</b></span></nobr></DIV>
<DIV style="position:absolute;top:433;left:51"><nobr><span class="ft4">The facade package also includes Listeners contributions to the core service in order to forward core<br>service events to the JMS topic.</span></nobr></DIV>
<DIV style="position:absolute;top:474;left:51"><nobr><span class="ft4">By default, all annotation related events are sent on the JMS topic : this can be useful for external<br>indexers, that may want to reindex the document when an annotation is createed or modified.</span></nobr></DIV>
<DIV style="position:absolute;top:515;left:51"><nobr><span class="ft4">The Facade will also host a MessageDrivenBean that will react to core document events (creation,<br>modification, delete). The behavior of this MDB will be configured via a dedicated Extension Point<br>(see below).</span></nobr></DIV>

<DIV style="position:absolute;top:586;left:51"><nobr><span class="ft6"><b>5.3. Extension points</b></span></nobr></DIV>
<DIV style="position:absolute;top:630;left:51"><nobr><span class="ft7"><b>5.3.1. annotationsRules</b></span></nobr></DIV>
<DIV style="position:absolute;top:661;left:51"><nobr><span class="ft4">This extension point takes configuration that will be used by the MDB to define what must be done<br>depending on the event.</span></nobr></DIV>
<DIV style="position:absolute;top:702;left:51"><nobr><span class="ft3">This configuration binds actions to events. Events are :</span></nobr></DIV>
<DIV style="position:absolute;top:725;left:70"><nobr><span class="ft3">â¢ documentModified</span></nobr></DIV>
<DIV style="position:absolute;top:751;left:70"><nobr><span class="ft3">â¢ documentVersionned</span></nobr></DIV>
<DIV style="position:absolute;top:778;left:70"><nobr><span class="ft3">â¢ documentPublished</span></nobr></DIV>
<DIV style="position:absolute;top:816;left:532"><nobr><span class="ft3">10</span></nobr></DIV>

</DIV>
<!-- Page 14 -->
<a name="14"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="595" height="842" src="index014.png" alt="background image">
<DIV style="position:absolute;top:56;left:70"><nobr><span class="ft3">â¢ documentDeleted</span></nobr></DIV>
<DIV style="position:absolute;top:83;left:70"><nobr><span class="ft3">â¢ documentCopied</span></nobr></DIV>
<DIV style="position:absolute;top:109;left:70"><nobr><span class="ft3">â¢ documentLifeCycleChanged</span></nobr></DIV>
<DIV style="position:absolute;top:133;left:51"><nobr><span class="ft3">Actions are :</span></nobr></DIV>
<DIV style="position:absolute;top:156;left:70"><nobr><span class="ft3">â¢ duplicate</span></nobr></DIV>

<DIV style="position:absolute;top:182;left:82"><nobr><span class="ft4">Duplicate annotation graph for the new document. Typically, this can be useful for document<br>versionning or document copy.</span></nobr></DIV>
<DIV style="position:absolute;top:223;left:70"><nobr><span class="ft3">â¢ relink</span></nobr></DIV>
<DIV style="position:absolute;top:250;left:82"><nobr><span class="ft4">Link the annotatation to the new document reference. Typically this can be usefull for<br>publishing.</span></nobr></DIV>
<DIV style="position:absolute;top:290;left:70"><nobr><span class="ft3">â¢ delete</span></nobr></DIV>
<DIV style="position:absolute;top:317;left:82"><nobr><span class="ft3">Remove the annotation graph. Typically, this can be usefull when document are deleted.</span></nobr></DIV>
<DIV style="position:absolute;top:343;left:70"><nobr><span class="ft3">â¢ nop</span></nobr></DIV>
<DIV style="position:absolute;top:370;left:82"><nobr><span class="ft3">Null operation</span></nobr></DIV>
<DIV style="position:absolute;top:406;left:51"><nobr><span class="ft4">This configuration will let the MDB define what action must be done when an event occurs. In most<br>case, the same action could be done directly by the synchronous event listener in the NXAS Core<br>service. But for performances reason, it is safer to let these actions handled asynchronously via JMS<br>and MDB pooling.</span></nobr></DIV>

<DIV style="position:absolute;top:16;left:233"><nobr><span class="ft3">Annotation Service Facade</span></nobr></DIV>
<DIV style="position:absolute;top:816;left:532"><nobr><span class="ft3">11</span></nobr></DIV>
</DIV>
<!-- Page 15 -->
<a name="15"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
  .ft10{font-size:19px;line-height:26px;font-family:Helvetica;color:#000000;}
-->
</STYLE>
<IMG width="595" height="842" src="index015.png" alt="background image">
<DIV style="position:absolute;top:58;left:51"><nobr><span class="ft10"><b>Chapter 6. Annotation Service Javascript<br>Library</b></span></nobr></DIV>
<DIV style="position:absolute;top:137;left:51"><nobr><span class="ft6"><b>6.1. overview</b></span></nobr></DIV>
<DIV style="position:absolute;top:172;left:51"><nobr><span class="ft4">This library offers a simple interface to interact with the NXAS Server. It allows to<br>create/read/update/delete annotations related to a URI, and to the URIs of the different version of the<br>corresponding document.</span></nobr></DIV>

<DIV style="position:absolute;top:227;left:51"><nobr><span class="ft4">This library also offers the UI functions to grab part of a document, including picture, and transform it<br>into URI using XPointer.</span></nobr></DIV>
<DIV style="position:absolute;top:283;left:51"><nobr><span class="ft6"><b>6.2. Implementation</b></span></nobr></DIV>
<DIV style="position:absolute;top:318;left:51"><nobr><span class="ft4">Implementation will be in pure JavaScript. JQuery library will be used for DOM manipulation and the<br>JQuery Dialog toolkit will be used to managing UI.</span></nobr></DIV>
<DIV style="position:absolute;top:374;left:51"><nobr><span class="ft6"><b>6.3. RDF / JSON</b></span></nobr></DIV>
<DIV style="position:absolute;top:409;left:51"><nobr><span class="ft4">The NXAS JS Library is dedciated to be used with Nuxeo Annotation service. Therefore, it does not<br>have to use RDF encoding. For optimization reason, the JS lib may use a JSON marshing rather than<br>plain RDF.</span></nobr></DIV>
<DIV style="position:absolute;top:479;left:51"><nobr><span class="ft6"><b>6.4. Annotating images</b></span></nobr></DIV>
<DIV style="position:absolute;top:514;left:51"><nobr><span class="ft4">The Client JS library will handle image annotation and permit to define a shape (rectangle/elipse) in<br>the image that should hold the annotation. The shape will be handled as respect to the image size in<br>the HTML. If the HTML conversion flattern all images in the documents as one background image in<br>the HTML preview, then the annotation client will see only one image.</span></nobr></DIV>

<DIV style="position:absolute;top:816;left:532"><nobr><span class="ft3">12</span></nobr></DIV>
</DIV>
<!-- Page 16 -->
<a name="16"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="595" height="842" src="index016.png" alt="background image">
<DIV style="position:absolute;top:58;left:51"><nobr><span class="ft5"><b>Chapter 7. Annotation Service HTTP Gateway</b></span></nobr></DIV>
<DIV style="position:absolute;top:110;left:51"><nobr><span class="ft6"><b>7.1. Overview</b></span></nobr></DIV>
<DIV style="position:absolute;top:145;left:51"><nobr><span class="ft4">The Annotation Service HTTP gateway provides the http API on top of the java APi of the Annotation<br>Service</span></nobr></DIV>
<DIV style="position:absolute;top:201;left:51"><nobr><span class="ft6"><b>7.2. Implementation</b></span></nobr></DIV>

<DIV style="position:absolute;top:236;left:51"><nobr><span class="ft3">The http gateway will be implemented as a set of restlets.</span></nobr></DIV>
<DIV style="position:absolute;top:263;left:51"><nobr><span class="ft4">The gateway package will also include serializer/deserializer for RDF and JSON. This allows the http<br>service to respond in RDF or JSON according to client requirements. The format parameter is simply<br>added to the standard Annota API, defaut format is RDF (for compliancy reasons).</span></nobr></DIV>
<DIV style="position:absolute;top:318;left:51"><nobr><span class="ft4">The URL filting will be delegated to the underlying Nuxeo Service, this HTTP layer is only a gateway<br>and must handle as less logic as possible.</span></nobr></DIV>
<DIV style="position:absolute;top:374;left:51"><nobr><span class="ft6"><b>7.3. Authentication</b></span></nobr></DIV>
<DIV style="position:absolute;top:409;left:51"><nobr><span class="ft3">The Annotation Restlet interface is guarded by the</span></nobr></DIV>
<DIV style="position:absolute;top:412;left:296"><nobr><span class="ft8">NuxeoAuthenticationFilter</span></nobr></DIV>
<DIV style="position:absolute;top:409;left:422"><nobr><span class="ft3">. This means that the</span></nobr></DIV>

<DIV style="position:absolute;top:423;left:51"><nobr><span class="ft3">access via http to the annotation service requires a valid authentication.</span></nobr></DIV>
<DIV style="position:absolute;top:453;left:51"><nobr><span class="ft8">NuxeoAuthenticationFilter</span></nobr></DIV>
<DIV style="position:absolute;top:450;left:180"><nobr><span class="ft3">will be configured (via it's EP) to let annotation related URLs be starting</span></nobr></DIV>
<DIV style="position:absolute;top:464;left:51"><nobr><span class="ft3">URLs.</span></nobr></DIV>
<DIV style="position:absolute;top:490;left:51"><nobr><span class="ft4">Annonymous access to the annotation service is possible, in the Anonymous Authentication Plugin is<br>deployed.</span></nobr></DIV>
<DIV style="position:absolute;top:547;left:51"><nobr><span class="ft6"><b>7.4. State management</b></span></nobr></DIV>
<DIV style="position:absolute;top:581;left:51"><nobr><span class="ft4">The restlets used to provide http access to the annotation service are stateless restlets.This means they<br>don't depend on Seam or JSF. Nevertheless, because of the Authentication system, client will have to<br>maintain a Session Cookie to avoid reauthenticating on each call.</span></nobr></DIV>

<DIV style="position:absolute;top:816;left:532"><nobr><span class="ft3">13</span></nobr></DIV>
</DIV>
<!-- Page 17 -->
<a name="17"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="595" height="842" src="index017.png" alt="background image">
<DIV style="position:absolute;top:58;left:51"><nobr><span class="ft5"><b>Chapter 8. Integrating the Annotation service</b></span></nobr></DIV>
<DIV style="position:absolute;top:95;left:51"><nobr><span class="ft3">Integrating the Nuxeo Annotation Service to your project may require several steps.</span></nobr></DIV>
<DIV style="position:absolute;top:137;left:51"><nobr><span class="ft6"><b>8.1. Configure preview</b></span></nobr></DIV>
<DIV style="position:absolute;top:172;left:51"><nobr><span class="ft4">You can use Nuxeo Preview adpaters extension points to configure how the html previews of your<br>documents will be generated.</span></nobr></DIV>

<DIV style="position:absolute;top:212;left:51"><nobr><span class="ft4">Default implementation includes preview via transformers and preview based on pre-stored data.<br>Please refer to the according documentation.</span></nobr></DIV>
<DIV style="position:absolute;top:268;left:51"><nobr><span class="ft6"><b>8.2. Configure Annotation policy</b></span></nobr></DIV>
<DIV style="position:absolute;top:303;left:51"><nobr><span class="ft4">The Annotation service exposes an Extension Point to define how annotations are managed during<br>versionning / publishing events. You can define your own configuration for that.</span></nobr></DIV>
<DIV style="position:absolute;top:359;left:51"><nobr><span class="ft6"><b>8.3. Configure Annotation Meta-data</b></span></nobr></DIV>
<DIV style="position:absolute;top:394;left:51"><nobr><span class="ft4">You can change default meta-data associated to the annotations. For this you need to contribute a<br>simple java class.</span></nobr></DIV>
<DIV style="position:absolute;top:435;left:51"><nobr><span class="ft3">Default implementation includes : author, timestamp, annotation type and author company</span></nobr></DIV>
<DIV style="position:absolute;top:477;left:51"><nobr><span class="ft6"><b>8.4. Handle indexing</b></span></nobr></DIV>

<DIV style="position:absolute;top:512;left:51"><nobr><span class="ft3">Nuxeo default indexing does not handle Annotation indexing.</span></nobr></DIV>
<DIV style="position:absolute;top:538;left:51"><nobr><span class="ft4">Nevertheless, if you use an external indexer, you may use a MDB to listen to Annotation events and<br>trigger a reinddexation of the target document. This means that your indexing wrapper will contact the<br>Annotation service to fetch the annotations associated to the document.</span></nobr></DIV>
<DIV style="position:absolute;top:609;left:51"><nobr><span class="ft6"><b>8.5. Integrate HTML/JS Client</b></span></nobr></DIV>
<DIV style="position:absolute;top:644;left:51"><nobr><span class="ft3">By default Nuxeo provides 2 clients : one integrated into the preview tab and one standalone.</span></nobr></DIV>
<DIV style="position:absolute;top:670;left:51"><nobr><span class="ft4">You may need to integrate the Preview in dedicated screens or to adapter the default screens to you<br>own graphic theme.</span></nobr></DIV>
<DIV style="position:absolute;top:816;left:532"><nobr><span class="ft3">14</span></nobr></DIV>
</DIV>
<!-- Page 18 -->

<a name="18"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="595" height="842" src="index018.png" alt="background image">
<DIV style="position:absolute;top:58;left:51"><nobr><span class="ft5"><b>Chapter 9. Packaging and deployment</b></span></nobr></DIV>
<DIV style="position:absolute;top:110;left:51"><nobr><span class="ft6"><b>9.1. Target platform</b></span></nobr></DIV>
<DIV style="position:absolute;top:145;left:51"><nobr><span class="ft3">The logical target plaform is Nuxeo EP 5.2.</span></nobr></DIV>
<DIV style="position:absolute;top:172;left:51"><nobr><span class="ft3">The NXAS Addon will also be available on 5.1 branch (5.1.6).</span></nobr></DIV>
<DIV style="position:absolute;top:213;left:51"><nobr><span class="ft6"><b>9.2. Packaging</b></span></nobr></DIV>
<DIV style="position:absolute;top:248;left:51"><nobr><span class="ft3">NXAS will be packaged as a set of java artifacts that are plugins for Nuxeo EP.</span></nobr></DIV>

<DIV style="position:absolute;top:275;left:51"><nobr><span class="ft3">Java artifacts includes :</span></nobr></DIV>
<DIV style="position:absolute;top:297;left:70"><nobr><span class="ft3">â¢</span></nobr></DIV>
<DIV style="position:absolute;top:300;left:82"><nobr><span class="ft8">nuxeo-platform-annotations-api</span></nobr></DIV>
<DIV style="position:absolute;top:324;left:70"><nobr><span class="ft3">â¢</span></nobr></DIV>
<DIV style="position:absolute;top:327;left:82"><nobr><span class="ft8">nuxeo-platform-annotations-core</span></nobr></DIV>
<DIV style="position:absolute;top:350;left:70"><nobr><span class="ft3">â¢</span></nobr></DIV>
<DIV style="position:absolute;top:353;left:82"><nobr><span class="ft8">nuxeo-platform-annotations-facade</span></nobr></DIV>
<DIV style="position:absolute;top:377;left:70"><nobr><span class="ft3">â¢</span></nobr></DIV>
<DIV style="position:absolute;top:380;left:82"><nobr><span class="ft8">nuxeo-platform-annotations-restlets</span></nobr></DIV>

<DIV style="position:absolute;top:403;left:70"><nobr><span class="ft3">â¢</span></nobr></DIV>
<DIV style="position:absolute;top:406;left:82"><nobr><span class="ft8">nuxeo-platform-annotations-preview-plugin</span></nobr></DIV>
<DIV style="position:absolute;top:429;left:70"><nobr><span class="ft3">â¢</span></nobr></DIV>
<DIV style="position:absolute;top:432;left:82"><nobr><span class="ft8">nuxeo-platform-annotations-html-client</span></nobr></DIV>
<DIV style="position:absolute;top:456;left:70"><nobr><span class="ft3">â¢</span></nobr></DIV>
<DIV style="position:absolute;top:459;left:82"><nobr><span class="ft8">nuxeo-platform-annotations-js-client</span></nobr></DIV>
<DIV style="position:absolute;top:482;left:70"><nobr><span class="ft3">â¢</span></nobr></DIV>
<DIV style="position:absolute;top:485;left:82"><nobr><span class="ft8">nuxeo-platform-annotations-tests</span></nobr></DIV>
<DIV style="position:absolute;top:506;left:51"><nobr><span class="ft3">Some of these artifacts are resources only artifacts (for JS and HTML).</span></nobr></DIV>

<DIV style="position:absolute;top:533;left:51"><nobr><span class="ft4">The support for NXAS inside the Nuxeo &quot;light packaging&quot; (Jetty bundle) is not directly targeted, but<br>this should not be a problem ouside of the facade artifact.</span></nobr></DIV>
<DIV style="position:absolute;top:816;left:532"><nobr><span class="ft3">15</span></nobr></DIV>
</DIV>
<!-- Page 19 -->
<a name="19"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
-->
</STYLE>
<IMG width="595" height="842" src="index019.png" alt="background image">
<DIV style="position:absolute;top:58;left:51"><nobr><span class="ft5"><b>Chapter 10. W3C Annotea compliance</b></span></nobr></DIV>

<DIV style="position:absolute;top:95;left:51"><nobr><span class="ft4">As explained before, Annotea specification is not broad enought to include all Nuxeo EP requirements<br>for managing Annotations.</span></nobr></DIV>
<DIV style="position:absolute;top:151;left:51"><nobr><span class="ft6"><b>10.1. Annotea clients.</b></span></nobr></DIV>
<DIV style="position:absolute;top:186;left:51"><nobr><span class="ft3">Nevertheless, NXAS will support Annotea basic clients like Mozilla Annozilla Annotea extension.</span></nobr></DIV>
<DIV style="position:absolute;top:212;left:51"><nobr><span class="ft4">Using a standard Annotea Client may retrain features : for examples additionnal metadata and Image<br>annotations won't be availables.</span></nobr></DIV>
<DIV style="position:absolute;top:268;left:51"><nobr><span class="ft6"><b>10.2. Annotea Algae.</b></span></nobr></DIV>
<DIV style="position:absolute;top:303;left:51"><nobr><span class="ft4">The Algae specification describe a Query Language that may be implemented by Annotea clients and<br>servers. NXAS won't implement Algae</span></nobr></DIV>
<DIV style="position:absolute;top:816;left:532"><nobr><span class="ft3">16</span></nobr></DIV>

</DIV>
<!-- Page 20 -->
<a name="20"></a>
<DIV style="position:relative;width:595;height:842;">
<STYLE type="text/css">
<!--
  .ft11{font-size:10px;font-family:Times;color:#0000ff;}
-->
</STYLE>
<IMG width="595" height="842" src="index020.png" alt="background image">
<DIV style="position:absolute;top:58;left:51"><nobr><span class="ft5"><b>Chapter 11. References</b></span></nobr></DIV>
<DIV style="position:absolute;top:91;left:70"><nobr><span class="ft3">â¢</span></nobr></DIV>
<DIV style="position:absolute;top:91;left:82"><nobr><span class="ft11"><A href="http://www.w3.org/2001/Annotea/User/Protocol.html"><i>W3C Annotea Protocols</i></a></span></nobr></DIV>
<DIV style="position:absolute;top:118;left:70"><nobr><span class="ft3">â¢</span></nobr></DIV>
<DIV style="position:absolute;top:118;left:82"><nobr><span class="ft11"><A href="http://doc.nuxeo.org/5.1/books/nuxeo-book/html-single/#nuxeo-platform-preview"><i>Nuxeo preview addon</i></a></span></nobr></DIV>

<DIV style="position:absolute;top:144;left:70"><nobr><span class="ft3">â¢</span></nobr></DIV>
<DIV style="position:absolute;top:144;left:82"><nobr><span class="ft11"><A href="http://www.w3.org/TR/xptr-framework/"><i>XPointer</i></a></span></nobr></DIV>
<DIV style="position:absolute;top:816;left:532"><nobr><span class="ft3">17</span></nobr></DIV>
</DIV>
<hr>
<A name="outline"></a><h1>Document Outline</h1>
<ul><li>ï¿½ï¿½
<li>ï¿½ï¿½
<li>ï¿½ï¿½
<ul><li>ï¿½ï¿½
<li>ï¿½ï¿½
<ul><li>ï¿½ï¿½
<li>ï¿½ï¿½

<li>ï¿½ï¿½
<li>ï¿½ï¿½
</ul><li>ï¿½ï¿½
<ul><li>ï¿½ï¿½
<li>ï¿½ï¿½
</ul></ul><li>ï¿½ï¿½
<li>ï¿½ï¿½
<ul><li>ï¿½ï¿½
<li>ï¿½ï¿½
</ul><li>ï¿½ï¿½
<ul><li>ï¿½ï¿½
<li>ï¿½ï¿½
<li>ï¿½ï¿½
<li>ï¿½ï¿½
<li>ï¿½ï¿½
<ul><li>ï¿½ï¿½
<li>ï¿½ï¿½

<li>ï¿½ï¿½
<li>ï¿½ï¿½
<li>ï¿½ï¿½
<li>ï¿½ï¿½
</ul><li>ï¿½ï¿½
<li>ï¿½ï¿½
<li>ï¿½ï¿½
</ul><li>ï¿½ï¿½
<ul><li>ï¿½ï¿½
<li>ï¿½ï¿½
<li>ï¿½ï¿½
<ul><li>ï¿½ï¿½
</ul></ul><li>ï¿½ï¿½
<ul><li>ï¿½ï¿½
<li>ï¿½ï¿½
<li>ï¿½ï¿½
<li>ï¿½ï¿½

</ul><li>ï¿½ï¿½
<ul><li>ï¿½ï¿½
<li>ï¿½ï¿½
<li>ï¿½ï¿½
<li>ï¿½ï¿½
</ul><li>ï¿½ï¿½
<ul><li>ï¿½ï¿½
<li>ï¿½ï¿½
<li>ï¿½ï¿½
<li>ï¿½ï¿½
<li>ï¿½ï¿½
</ul><li>ï¿½ï¿½
<ul><li>ï¿½ï¿½
<li>ï¿½ï¿½
</ul><li>ï¿½ï¿½
<ul><li>ï¿½ï¿½
<li>ï¿½ï¿½

</ul><li>ï¿½ï¿½
</ul></BODY>
</HTML>
