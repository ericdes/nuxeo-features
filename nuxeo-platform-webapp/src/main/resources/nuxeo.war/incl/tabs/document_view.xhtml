<div xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:fn="http://java.sun.com/jsp/jstl/functions"
  xmlns:nxdir="http://nuxeo.org/nxdirectory"
  xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:nxh="http://nuxeo.org/nxweb/html"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:nxu="http://nuxeo.org/nxweb/util">

<script src="scripts/infoPopup.js"></script>

<h:form id="document_view">
<h:outputFormat value="#{messages['label.resum.intro.created']}" >
   <f:param value="#{currentDocument.dc.creator}"/>
   <f:param value="#{nxu:formatDateUsingBasicFormatter(currentDocument.dc.created)}"/>
   <f:param value="\'#{messages[currentDocument.currentLifeCycleState]}\'"/>
</h:outputFormat>
<h:outputFormat value=" #{messages['label.resum.intro.contributor']}" rendered="#{fn:length(currentDocument.dc.contributors) == 1}" >
   <f:param value="#{currentDocument.dc.creator}"/>
</h:outputFormat>

<c:set var="andLabel" value=" #{messages['label.and']} " scope="page" />

<div>
<h:outputFormat value=" #{messages['label.resum.intro.contributors']}" rendered="#{fn:length(currentDocument.dc.contributors) != 1}" >
   <f:param value="#{nxu:joinArrayWithFinalDelimiter(currentDocument.dc.contributors,', ',andLabel)}"/>
</h:outputFormat>
<nxu:methodResult name="versionable" value="#{currentDocument.hasFacet('Versionable')}">
  <h:outputFormat value=" #{messages['label.resum.intro.modifiedAndVersion']}" rendered="#{versionable}" >
    <f:param value="#{nxu:formatDateUsingBasicFormatter(currentDocument.dublincore.modified)}"/>
    <f:param value="#{currentDocumentVersionInfo.versionLabel}"/>
  </h:outputFormat>
  <h:outputFormat value=" #{messages['label.resum.intro.modified']}" rendered="#{!versionable}">
    <f:param value="#{nxu:formatDateUsingBasicFormatter(currentDocument.dublincore.modified)}"/>
  </h:outputFormat>
</nxu:methodResult>
</div>
<div>
<h:panelGroup rendered="${!empty lockActions.currentDocLockDetails}">
  <h:outputFormat value="#{messages['label.resum.intro.locked']} ">
    <f:param value="${lockActions.currentDocLockDetails['document.locker']}"/>
  </h:outputFormat>

  <h:commandLink value="#{messages['command.unlock']}"
        action="#{lockActions.unlockCurrentDocument}"
        rendered="#{lockActions.canUnlockCurrentDoc}" />
</h:panelGroup>
<h:panelGroup rendered="${empty lockActions.currentDocLockDetails}">
  <h:commandLink value="#{messages['command.lock']}"
        action="#{lockActions.lockCurrentDocument}"
        rendered="#{lockActions.canLockCurrentDoc}" />
</h:panelGroup>
</div>
<div>
<nxu:methodResult name="commentable" value="#{currentDocument.hasFacet('Commentable')}">
<h:panelGroup rendered="#{commentable and (documentThreadedComments.size > 0)}">
<!--<nxh:commandLink value="#{documentThreadedComments.size}" action="#{navigationContext.navigateToDocumentWithView(currentDocument,comment_tab_actions.id)}"/>-->
<nxd:restDocumentLink document="#{currentDocument}" tab="view_comments" >
	<h:outputText value="#{documentThreadedComments.size}"/>
</nxd:restDocumentLink>
<h:outputText value=" #{messages['label.resum.intro.comments']}"/>
</h:panelGroup>
</nxu:methodResult>
</div>


<h3><h:outputText value="#{messages['label.description']}" /></h3>
<h:outputText value="#{currentDocument.dc.description}" />
<nxu:methodResult name="hasFileFacet" value="#{currentDocument.hasSchema('file')}">
<h:panelGroup rendered="#{hasFileFacet}">
<h3><h:outputText value="#{messages['action.view.content']}" /></h3>
<h:outputText value="#{messages['label.resum.download']} "/>
<nxh:outputLink value="#{nxd:fileUrl('downloadFile', currentDocument, field.fullName, currentDocument.file.filename)}"><h:outputText value="#{currentDocument.file.filename}"/></nxh:outputLink>
      <c:if test="#{conversionActions.pdfConverterAvailability.available}">
        <nxu:methodResult name="hasPDFCapabilities" value="#{conversionActions.isFileExportableToPDF(field.fullName)}">
          <h:panelGroup rendered="#{hasPDFCapabilities}">
            <h:outputText value=" #{messages['label.resum.download.other']} "/>
            <h:commandLink action="#{conversionActions.generatePdfFile}">
              <f:param name="fileFieldFullName" value="#{field.fullName}" />
              <f:param name="filename" value="#{currentDocument.file.filename}" />
              <h:outputText value="#{messages['label.resum.download.pdf']}"/>
            </h:commandLink>
          </h:panelGroup>
        </nxu:methodResult>
      </c:if>
</h:panelGroup>
</nxu:methodResult>
<nxd:restDocumentLink document="#{currentDocument}" tab="TAB_METADATA_EDIT" >
	<h:outputText value=" [#{ messages['label.resum.edit']}] "/>
</nxd:restDocumentLink>
</h:form>
<div>
<nxu:methodResult name="hasFilesFacet" value="#{currentDocument.hasSchema('files')}">
<h:panelGroup rendered="#{hasFilesFacet  and (!empty currentDocument.files.files)}">
<h:outputText value=" #{messages['label.resum.download.attachments']} "/>
<ui:include src="/incl/tabs/document_files_view.xhtml"/>
</h:panelGroup>
</nxu:methodResult>
</div>
<BR/>
	<div class="foldableBox">
      <h3 class="unfolded">
        <a href="#nologo" onclick="return toggleBox(this)">
          <h:outputText value="#{messages['label.resum.rank.title']}"/>
        </a>
      </h3>
      <div class="boxBody">
        <ui:include src="/resum/rank.xhtml" />
      </div>
    </div>
    
    <div class="foldableBox">
      <h3 class="unfolded">
        <a href="#nologo" onclick="return toggleBox(this)">
          <h:outputText value="#{messages['label.resum.links.title']}"/>
        </a>
      </h3>
      <div class="boxBody">
        <ui:include src="/resum/links.xhtml" />
      </div>
    </div>
    
    <div class="foldableBox">
      <h3 class="folded">
        <a href="#nologo" onclick="return toggleBox(this)">
          <h:outputText value="#{messages['label.resum.characteristics.title']}"/>
        </a>
      </h3>
      <div class="boxBody" style="display: none">
        <ui:include src="/resum/characteristics.xhtml" />
      </div>
    </div>


</div>
